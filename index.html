<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动物园规则怪谈 - 交互探索版</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        :root {
            --primary-color: #8b0000;
            --secondary-color: #4fc3f7;
            --bg-color: #f5ecd7;
            --paper-color: #fefcf5;
            --border-color: #d4c9af;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Courier Prime', monospace;
            background-color: var(--bg-color);
            color: #3a3225;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d4c9af' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .start-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background-color: var(--paper-color);
            padding: 20px;
            text-align: center;
        }
        
        .game-title {
            font-size: 3em;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.8;
        }
        
        .start-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 300px;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 20px;
            font-family: 'Courier Prime', monospace;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .btn:hover {
            background-color: #a00000;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #29b6f6;
        }
        
        .hidden {
            display: none !important;
        }
        
        .game-container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        
        .sidebar {
            width: 300px;
            background-color: var(--paper-color);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            padding: 15px 20px;
            background-color: var(--paper-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .subtitle {
            margin: 5px 0 0;
            font-style: italic;
            color: #666;
        }
        
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        .rules-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.3em;
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .rule {
            margin-bottom: 10px;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.7);
            border-left: 3px solid var(--primary-color);
        }
        
        .rule-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 5px;
        }
        
        .warning {
            background-color: rgba(255, 240, 240, 0.8);
            border-left: 3px solid #ff0000;
        }
        
        .warning .rule-number {
            color: #ff0000;
        }
        
        .triggered-rule {
            background-color: rgba(79, 195, 247, 0.1);
            animation: highlight 2s;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(79, 195, 247, 0.5); }
            100% { background-color: rgba(79, 195, 247, 0.1); }
        }
        
        .map-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .zoo-map {
            max-width: 100%;
            height: auto;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
        }
        
        .area-info {
            background-color: var(--paper-color);
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .area-title {
            font-size: 1.5em;
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .area-description {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .interaction-area {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border: 1px dashed var(--border-color);
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .event-title {
            font-size: 1.2em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .choices {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .choice-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            font-family: 'Courier Prime', monospace;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 3px;
        }
        
        .choice-btn:hover {
            background-color: #a00000;
            box-shadow: 0 0 5px rgba(139, 0, 0, 0.5);
        }
        
        .outcome {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 240, 240, 0.9);
            border-radius: 5px;
            animation: fadeIn 1s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .ending {
            text-align: center;
            padding: 30px;
            background-color: var(--paper-color);
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .ending-title {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .ending-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .restart-btn {
            background-color: var(--secondary-color);
            color: #333;
        }
        
        .restart-btn:hover {
            background-color: #29b6f6;
        }
        
        .map-area {
            position: relative;
            cursor: pointer;
        }
        
        .map-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.9em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }
        
        .visited {
            opacity: 0.7;
        }
        
        .current-location {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .rules-button {
            background-color: var(--secondary-color);
            color: #333;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .rules-button:hover {
            background-color: #29b6f6;
        }
        
        .triggered-rules-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .triggered-rule-item {
            padding: 5px;
            margin-bottom: 5px;
            border-left: 2px solid var(--secondary-color);
            background-color: rgba(79, 195, 247, 0.1);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background-color: var(--paper-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-item {
            display: flex;
            align-items: center;
        }
        
        .status-label {
            font-weight: bold;
            margin-right: 5px;
        }
        
        .progress-bar {
            width: 100px;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--secondary-color);
            transition: width 0.3s;
        }
        
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .inventory-item {
            padding: 5px 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        .save-load-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .save-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .save-slot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
        }
        
        .save-slot:hover {
            background-color: rgba(79, 195, 247, 0.1);
        }
        
        .save-info {
            font-size: 0.9em;
            color: #666;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .game-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }
    </style>
</head>
<body>
    <div id="startScreen" class="start-screen">
        <h1 class="game-title">动物园规则怪谈</h1>
        <div class="game-subtitle">
            欢迎来到本市最大的动物园。我们收录世界上大部分动物，并保证为每一种动物都打造适宜它们的环境。
            在观光游览时，请务必遵守园区规则，以确保您的安全，否则后果自负。
        </div>
        <div class="start-options">
            <button class="btn" onclick="startNewGame()">开始新游戏</button>
            <button class="btn btn-secondary" onclick="loadGameScreen()">加载存档</button>
        </div>
    </div>
    
    <div id="gameContainer" class="game-container hidden">
        <div class="sidebar">
            <button class="rules-button" onclick="toggleRules()">查看完整规则</button>
            
            <div class="rules-section">
                <div class="section-title">已触发的规则</div>
                <div class="triggered-rules-list" id="triggeredRules">
                    <div class="triggered-rule-item">暂无触发的规则</div>
                </div>
            </div>
            
            <div class="rules-section">
                <div class="section-title">当前状态</div>
                <div class="status-item">
                    <span class="status-label">认知稳定性:</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cognitionBar" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-label">已探索区域:</span>
                    <span id="exploredAreas">0/6</span>
                </div>
            </div>
            
            <div class="rules-section">
                <div class="section-title">物品栏</div>
                <div class="inventory" id="inventory">
                    <div class="inventory-item">动物园地图</div>
                </div>
            </div>
            
            <div class="save-load-section">
                <div class="section-title">存档管理</div>
                <div class="save-slots" id="saveSlots">
                    <!-- 存档槽位将通过JavaScript动态生成 -->
                </div>
                <button class="btn btn-secondary" onclick="saveGame()" style="width: 100%; margin-top: 10px;">保存游戏</button>
                <button class="btn" onclick="returnToStart()" style="width: 100%; margin-top: 10px;">返回主菜单</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <div>
                    <h1>动物园规则怪谈</h1>
                    <div class="subtitle">当前位置: <span id="currentLocation">动物园入口</span></div>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="saveGame()">快速存档</button>
                </div>
            </div>
            
            <div class="content-area" id="contentArea">
                <div class="map-container">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5ecd7'/%3E%3Crect x='50' y='50' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='150' y='125' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E兔子园区%3C/text%3E%3Crect x='300' y='50' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='400' y='125' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E狮子园区%3C/text%3E%3Crect x='550' y='50' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='650' y='125' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E大象园区%3C/text%3E%3Crect x='50' y='250' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='150' y='325' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E猿类园区%3C/text%3E%3Crect x='300' y='250' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='400' y='325' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E超市%3C/text%3E%3Crect x='550' y='250' width='200' height='150' fill='%23e8dfc8' stroke='%238b0000' stroke-width='2'/%3E%3Ctext x='650' y='325' text-anchor='middle' fill='%238b0000' font-family='Courier Prime' font-size='16'%3E海洋馆%3C/text%3E%3C/svg%3E" 
                         alt="动物园地图" class="zoo-map" usemap="#zooMap">
                    <map name="zooMap">
                        <area shape="rect" coords="50,50,250,200" alt="兔子园区" onclick="visitArea('rabbit')">
                        <area shape="rect" coords="300,50,500,200" alt="狮子园区" onclick="visitArea('lion')">
                        <area shape="rect" coords="550,50,750,200" alt="大象园区" onclick="visitArea('elephant')">
                        <area shape="rect" coords="50,250,250,400" alt="猿类园区" onclick="visitArea('ape')">
                        <area shape="rect" coords="300,250,500,400" alt="超市" onclick="visitArea('market')">
                        <area shape="rect" coords="550,250,750,400" alt="海洋馆" onclick="visitArea('aquarium')">
                    </map>
                </div>
                
                <div class="area-info">
                    <div class="area-title" id="areaTitle">欢迎来到动物园</div>
                    <div class="area-description" id="areaDescription">
                        您刚刚进入动物园，手中拿着入园时发放的地图和游客守则。请选择您想参观的区域开始您的旅程。
                        记住，遵守规则是确保您安全的关键。
                    </div>
                </div>
                
                <div class="interaction-area" id="interactionArea">
                    <!-- 交互内容将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>
    
    <div id="rulesOverlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto; padding: 20px; box-sizing: border-box;">
        <div style="max-width: 800px; margin: 20px auto; background-color: var(--paper-color); padding: 30px; border-radius: 5px; position: relative;">
            <button style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5em; cursor: pointer; color: var(--primary-color);" onclick="toggleRules()">×</button>
            <h2>动物园游客守则</h2>
            
            <div class="rule">
                <span class="rule-number">1.</span> 本园安全措施保障绝对没有问题，动物没有出逃的可能性，尤其是小型草食动物大多被关押在不可触摸的封闭性环境里。
            </div>
            
            <div class="rule">
                <span class="rule-number">2.</span> 猿类的园区只有一条街道，且只展示猿类动物。如果您发现了两条街道，且展示动物包括兔子，请选择左边那条，并尽可能快速地结束对该园区的参观。
            </div>
            
            <div class="rule">
                <span class="rule-number">3.</span> 大象是一种体型巨大、有着扇子一般的耳朵、鼻子很长、腿粗得像柱子的生物，而且不是白色的。请确保你在大象园区看见的是且只有大象。
            </div>
            
            <div class="rule">
                <span class="rule-number">4.</span> 动物园的超市不提供"兔子血"，如果您在货架上看见了，请不要购买。
            </div>
            
            <div class="rule">
                <span class="rule-number">5.</span> 不要独自停留在兔子园区的树荫下。
            </div>
            
            <div class="rule">
                <span class="rule-number">6.</span> 本园没有海洋馆。如果有工作人员向您贩卖海洋馆的票，拒绝他们。
            </div>
            
            <div class="rule">
                <span class="rule-number">7.</span> 如果您已经看见了海洋馆，立刻离开，并打通地图上标记的电话进行告知。
            </div>
            
            <div class="rule">
                <span class="rule-number">8.</span> 不要投喂兔子。其余的动物都可以。
            </div>
            
            <div class="rule">
                <span class="rule-number">9.</span> 兔子不会发出笑声。如果您在参观兔子园区时听见明显不来自游客方向的笑声，离开园区前，请把地图上虚线处撕下来握住，在彻底离开动物园时不要离手。
            </div>
            
            <div class="rule">
                <span class="rule-number">10.</span> 如果您触犯了以上任何一条，并且发现自己正在迷路状态，和其他熟人走散，请立刻在一刻钟内找到离您最近的超市，告知那里穿蓝色工作服的售货员（注意，如果看见穿黑色工作服的售货员，不论对方对您说什么都请假装没听见），他会马上带您到狮子园区的工作通道。不要害怕，这里的狮子不会袭击您，躲在假山后面，等所有的白狮子都开始吼叫后，工作人员将会带你离开园区（请确认他是蓝色衣服），这时候你的家人朋友会在狮子园区门口等着你。在这一切之后，立刻离开动物园。
            </div>
            
            <div class="rule warning">
                <span class="rule-number">11.</span> 本园只有四头白狮子。如果在第十条描述的情况中你看见了四头以上白狮子在吼叫，不要离开园区，并告知工作人员，等白狮子数量恢复四头后再离开。
            </div>
            
            <div class="rule">
                <span class="rule-number">12.</span> 可以给12岁及以下的孩子购买任何动物周边玩具，包括兔子；13-17岁的孩子购买兔子玩偶后，请在一个月内丢弃；18岁及以上的人群不可以购买兔子玩具。
            </div>
            
            <div class="rule">
                <span class="rule-number">13.</span> 如果看见有戴兔子耳饰的人跟随人流进入大象园区，必须放弃参观该园区。如果违反本条，本园不对您的安全负责，且无法给您提供解决方案。
            </div>
            
            <div class="rule warning">
                <span class="rule-number">14.</span> 狮子园区是安全的。如果您遭遇任何您无法解决的危险事件，也无法求助，请立刻、不择手段、尽一切可能前往狮子园区。
            </div>
            
            <div class="rule">
                <span class="rule-number">15.</span> 警惕和您走散过一次以上的朋友，尤其是他们反复劝你前往海洋馆或大象园区时。
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        let gameState = {
            currentArea: 'entrance',
            visitedAreas: ['entrance'],
            triggeredRules: [],
            cognitiveStability: 100,
            inventory: ['map'],
            hasMap: true,
            hasDashedLine: false,
            endings: [],
            currentEvent: null,
            gameStarted: false
        };

        // 区域信息
        const areas = {
            entrance: {
                title: '动物园入口',
                description: '您刚刚进入动物园，手中拿着入园时发放的地图和游客守则。请选择您想参观的区域开始您的旅程。记住，遵守规则是确保您安全的关键。'
            },
            rabbit: {
                title: '兔子园区',
                description: '这里展示着各种可爱的兔子。园区内有许多灌木和树荫，兔子们在围栏内安静地活动。'
            },
            lion: {
                title: '狮子园区',
                description: '雄伟的白狮子在园区内悠闲地踱步。园区中央有一个假山，是狮子们休息的地方。'
            },
            elephant: {
                title: '大象园区',
                description: '庞大的大象在园区内活动。园区边缘有标示牌，描述了大象的特征和习性。'
            },
            ape: {
                title: '猿类园区',
                description: '聪明的猿类在园区内活动。这里只有一条街道，展示着各种猿类动物。'
            },
            market: {
                title: '超市',
                description: '园区内的超市提供各种饮料和零食。货架上摆满了商品，店员穿着蓝色工作服。'
            },
            aquarium: {
                title: '海洋馆',
                description: '一个不应该存在的建筑。里面展示着各种海洋生物，但似乎有些异常。'
            }
        };

        // 事件系统
        const events = {
            rabbit: [
                {
                    title: '逃跑的兔子',
                    description: '您发现一只兔子从围栏中逃了出来，正在路边吃草。',
                    choices: [
                        { text: '远离并报告工作人员', outcome: '您按照规则远离了兔子并找到了工作人员。工作人员迅速处理了情况。', rules: [1], stability: 0 },
                        { text: '靠近观察', outcome: '您靠近了兔子，它突然停止吃草，用红色的眼睛盯着您。您感到一阵不安。', rules: [1], stability: -10 },
                        { text: '尝试触摸', outcome: '当您伸手想要触摸兔子时，它突然高速向您冲来！您慌忙后退，心跳加速。', rules: [1], stability: -20 }
                    ]
                },
                {
                    title: '树荫下的异常',
                    description: '您在兔子园区的树荫下休息时，感觉周围变得异常安静。',
                    choices: [
                        { text: '立即离开', outcome: '您迅速离开了树荫区域，周围的声音恢复正常。', rules: [5], stability: 0 },
                        { text: '继续停留', outcome: '您继续待在树荫下，感觉周围的阴影似乎在移动。您开始感到不安。', rules: [5], stability: -15 },
                        { text: '呼叫工作人员', outcome: '您大声呼叫工作人员，一名蓝衣员工迅速赶来，引导您离开了该区域。', rules: [5], stability: 0 }
                    ]
                },
                {
                    title: '诡异的笑声',
                    description: '您在参观兔子园区时，听到了明显不来自游客方向的笑声。',
                    choices: [
                        { text: '撕下地图虚线紧握', outcome: '您按照规则撕下地图虚线部分紧紧握住。笑声逐渐远去，您安全离开了园区。', rules: [9], stability: 0, addItem: 'dashedLine' },
                        { text: '装作没听见', outcome: '您装作没听见继续参观，但笑声似乎越来越近，您感到一阵寒意。', rules: [9], stability: -10 },
                        { text: '寻找声源', outcome: '您试图寻找笑声的来源，但只看到空荡荡的树丛。笑声突然在您身后响起！', rules: [9], stability: -20 }
                    ]
                }
            ],
            lion: [
                {
                    title: '白狮子数量异常',
                    description: '您注意到白狮子的数量似乎超过了四头。',
                    choices: [
                        { text: '立即报告工作人员', outcome: '您立即向蓝衣员工报告了情况。员工点点头，迅速前往处理。', rules: [11], stability: 0 },
                        { text: '继续观察', outcome: '您继续观察白狮子，发现它们的眼睛似乎有些异常。您感到不安。', rules: [11], stability: -10 },
                        { text: '装作没看见', outcome: '您装作没看见异常，但感觉有视线在背后盯着您。', rules: [11], stability: -15 }
                    ]
                },
                {
                    title: '狮子吼叫',
                    description: '所有的白狮子突然开始齐声吼叫。',
                    choices: [
                        { text: '躲在假山后等待', outcome: '您按照规则躲在假山后面，等待吼叫结束。不久后，一名蓝衣员工前来引导您离开。', rules: [10], stability: 0 },
                        { text: '立即逃离', outcome: '您惊慌地逃离狮子园区，但感觉有什么东西在跟着您。', rules: [10], stability: -15 },
                        { text: '向蓝衣员工求助', outcome: '您找到一名蓝衣员工，他带您前往安全区域。', rules: [10], stability: 0 }
                    ]
                }
            ]
            // 其他区域的事件类似，为简洁起见省略...
        };

        // 初始化游戏
        function startNewGame() {
            gameState = {
                currentArea: 'entrance',
                visitedAreas: ['entrance'],
                triggeredRules: [],
                cognitiveStability: 100,
                inventory: ['map'],
                hasMap: true,
                hasDashedLine: false,
                endings: [],
                currentEvent: null,
                gameStarted: true
            };
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            updateGameDisplay();
            updateSaveSlots();
        }

        // 加载游戏界面
        function loadGameScreen() {
            updateSaveSlots();
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
        }

        // 返回开始界面
        function returnToStart() {
            document.getElementById('gameContainer').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // 访问区域
        function visitArea(areaId) {
            if (!gameState.visitedAreas.includes(areaId)) {
                gameState.visitedAreas.push(areaId);
            }
            
            gameState.currentArea = areaId;
            document.getElementById('currentLocation').textContent = areas[areaId].title;
            
            updateGameDisplay();
            
            // 随机触发事件
            if (events[areaId] && Math.random() > 0.3) {
                const eventIndex = Math.floor(Math.random() * events[areaId].length);
                triggerEvent(areaId, eventIndex);
            }
        }

        // 触发事件
        function triggerEvent(areaId, eventIndex) {
            const event = events[areaId][eventIndex];
            gameState.currentEvent = event;
            
            const interactionArea = document.getElementById('interactionArea');
            interactionArea.innerHTML = `
                <div class="event-title">${event.title}</div>
                <div class="area-description">${event.description}</div>
                <div class="choices">
                    ${event.choices.map((choice, index) => 
                        `<button class="choice-btn" onclick="makeChoice(${index})">${choice.text}</button>`
                    ).join('')}
                </div>
                <div id="eventOutcome" class="outcome"></div>
            `;
        }

        // 做出选择
        function makeChoice(choiceIndex) {
            const event = gameState.currentEvent;
            const choice = event.choices[choiceIndex];
            
            // 更新游戏状态
            gameState.cognitiveStability += choice.stability;
            if (gameState.cognitiveStability > 100) gameState.cognitiveStability = 100;
            if (gameState.cognitiveStability < 0) gameState.cognitiveStability = 0;
            
            // 添加触发的规则
            choice.rules.forEach(rule => {
                if (!gameState.triggeredRules.includes(rule)) {
                    gameState.triggeredRules.push(rule);
                }
            });
            
            // 添加物品
            if (choice.addItem && !gameState.inventory.includes(choice.addItem)) {
                gameState.inventory.push(choice.addItem);
                if (choice.addItem === 'dashedLine') {
                    gameState.hasDashedLine = true;
                }
            }
            
            // 显示结果
            const outcomeElement = document.getElementById('eventOutcome');
            outcomeElement.innerHTML = `<p>${choice.outcome}</p>`;
            outcomeElement.style.display = 'block';
            
            // 检查是否触发结局
            checkForEnding();
            
            // 更新显示
            updateGameDisplay();
        }

        // 检查是否触发结局
        function checkForEnding() {
            // 这里可以根据游戏状态检查是否触发各种结局
            // 例如：认知稳定性过低、特定物品组合、特定规则触发等
            
            if (gameState.cognitiveStability <= 0) {
                triggerEnding('G'); // 变成兔子
            }
            
            // 其他结局条件...
        }

        // 触发结局
        function triggerEnding(endingCode) {
            const endings = {
                'A': {
                    title: '结局 A - 安全离开',
                    description: '您遵循了所有规则，顺利参观了动物园并安全离开。您没有看到任何异常，度过了一个愉快的下午。'
                },
                'B': {
                    title: '结局 B - 与人群离开',
                    description: '虽然您看到了一些奇怪的东西，但始终和熟人朋友在一起，最终跟随人群安全离开了动物园。'
                },
                'C': {
                    title: '结局 C - 被净化离开',
                    description: '您触犯了规则并迷路，但及时向正确的员工求助。白狮子的吼叫驱逐了"它"并净化了您被扭曲的认知，之后您安全离园。'
                },
                'D': {
                    title: '结局 D - 困在海洋馆',
                    description: '您触犯规定且迷路，未及时求助，独自发现海洋馆并进入休息。现在您被困在里面，一直在想办法逃离。'
                },
                'E': {
                    title: '结局 E - 成为黑衣员工',
                    description: '您受到严重污染，发现海洋馆门口的告示并换上黑衣服。您按照告示行动，从猿猴区右侧街道离开，但去向不明。'
                },
                'F': {
                    title: '结局 F - 困在动物园',
                    description: '您成为黑衣员工但立场不坚定，用掉了虚线却没有选择正确的出口。现在您困在动物园里，试图抢走别人的虚线。'
                },
                'G': {
                    title: '结局 G - 变成兔子',
                    description: '您的认知完全被扭曲，最终变成了一只兔子。您被"它"吃掉，剩余的部分被做成"兔子血"。'
                },
                'H': {
                    title: '结局 H - 被白狮子吃掉',
                    description: '您变成兔子后，被白狮子发现并吃掉。至少这样结束了您的痛苦。'
                },
                'I': {
                    title: '结局 I - 被收容',
                    description: '您变成兔子后被工作人员发现并收容。您将在动物园中度过余生，成为展示的一部分。'
                }
            };
            
            const ending = endings[endingCode];
            if (ending && !gameState.endings.includes(endingCode)) {
                gameState.endings.push(endingCode);
                
                const contentArea = document.getElementById('contentArea');
                contentArea.innerHTML = `
                    <div class="ending">
                        <div class="ending-title">${ending.title}</div>
                        <div class="ending-description">${ending.description}</div>
                        <button class="btn restart-btn" onclick="returnToStart()">返回主菜单</button>
                        <button class="btn" onclick="startNewGame()" style="margin-left: 10px;">重新开始</button>
                    </div>
                `;
                
                // 自动保存游戏
                saveGame();
            }
        }

        // 更新游戏显示
        function updateGameDisplay() {
            // 更新当前位置
            document.getElementById('currentLocation').textContent = areas[gameState.currentArea].title;
            
            // 更新区域信息
            document.getElementById('areaTitle').textContent = areas[gameState.currentArea].title;
            document.getElementById('areaDescription').textContent = areas[gameState.currentArea].description;
            
            // 更新认知稳定性
            document.getElementById('cognitionBar').style.width = `${gameState.cognitiveStability}%`;
            
            // 更新已探索区域
            document.getElementById('exploredAreas').textContent = `${gameState.visitedAreas.length - 1}/6`;
            
            // 更新触发的规则
            const triggeredRulesElement = document.getElementById('triggeredRules');
            if (gameState.triggeredRules.length === 0) {
                triggeredRulesElement.innerHTML = '<div class="triggered-rule-item">暂无触发的规则</div>';
            } else {
                triggeredRulesElement.innerHTML = gameState.triggeredRules.map(rule => 
                    `<div class="triggered-rule-item">规则 ${rule}: ${getRuleDescription(rule)}</div>`
                ).join('');
            }
            
            // 更新物品栏
            const inventoryElement = document.getElementById('inventory');
            inventoryElement.innerHTML = gameState.inventory.map(item => 
                `<div class="inventory-item">${getItemName(item)}</div>`
            ).join('');
        }

        // 获取规则描述
        function getRuleDescription(ruleNumber) {
            const ruleDescriptions = {
                1: '看到逃跑的兔子要远离并报告',
                2: '猿类园区出现两条街道要走左边',
                3: '确保大象园区只有真正的大象',
                4: '超市不提供"兔子血"不要购买',
                5: '不要独自停留在兔子园区的树荫下',
                6: '本园没有海洋馆，拒绝门票',
                7: '如果看见海洋馆要离开并报告',
                8: '不要投喂兔子',
                9: '听到笑声要撕下地图虚线握住',
                10: '触犯规则迷路时要找蓝衣员工',
                11: '只有四头白狮子，发现异常要报告',
                12: '年龄限制购买兔子周边',
                13: '看到戴兔子耳饰的人进入大象园区要放弃参观',
                14: '狮子园区是安全的',
                15: '警惕走散过的朋友'
            };
            
            return ruleDescriptions[ruleNumber] || '未知规则';
        }

        // 获取物品名称
        function getItemName(item) {
            const itemNames = {
                'map': '动物园地图',
                'dashedLine': '地图虚线部分'
            };
            
            return itemNames[item] || item;
        }

        // 切换规则显示
        function toggleRules() {
            const rulesOverlay = document.getElementById('rulesOverlay');
            rulesOverlay.classList.toggle('hidden');
        }

        // 保存游戏
        function saveGame() {
            const saveData = {
                ...gameState,
                saveTime: new Date().toLocaleString()
            };
            
            // 获取现有存档
            let saves = JSON.parse(localStorage.getItem('zooRuleSaves') || '[]');
            
            // 限制存档数量为3个
            if (saves.length >= 3) {
                saves.shift(); // 移除最旧的存档
            }
            
            // 添加新存档
            saves.push(saveData);
            
            // 保存到本地存储
            localStorage.setItem('zooRuleSaves', JSON.stringify(saves));
            
            // 更新存档显示
            updateSaveSlots();
            
            alert('游戏已保存！');
        }

        // 加载游戏
        function loadGame(saveIndex) {
            const saves = JSON.parse(localStorage.getItem('zooRuleSaves') || '[]');
            if (saves.length > saveIndex) {
                gameState = saves[saveIndex];
                gameState.gameStarted = true;
                
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('gameContainer').classList.remove('hidden');
                
                updateGameDisplay();
            }
        }

        // 更新存档槽位显示
        function updateSaveSlots() {
            const saveSlotsElement = document.getElementById('saveSlots');
            const saves = JSON.parse(localStorage.getItem('zooRuleSaves') || '[]');
            
            if (saves.length === 0) {
                saveSlotsElement.innerHTML = '<div class="save-slot">暂无存档</div>';
            } else {
                saveSlotsElement.innerHTML = saves.map((save, index) => `
                    <div class="save-slot" onclick="loadGame(${index})">
                        <div>存档 ${index + 1}</div>
                        <div class="save-info">${save.saveTime}</div>
                    </div>
                `).join('');
            }
        }

        // 初始化存档显示
        updateSaveSlots();
    </script>
</body>
</html>
